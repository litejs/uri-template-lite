{"version":3,"file":"index.umd.production.min.cjs","sources":["../src/index.ts"],"sourcesContent":["/* global escape */\n\n\n/*! litejs.com/MIT-LICENSE.txt */\n\n\t/**\n\t * URI Template\n\t * @see http://tools.ietf.org/html/rfc6570\n\t */\n\n\tvar RESERVED = /[!'()]/g\n\t// /[[\\]:\\/!#$&()*+,;='?@]/g\n\t, SEPARATORS = {\"\": \",\", \"+\": \",\", \"#\": \",\", \"?\": \"&\"}\n\t, escapeRe = /[$-/?[-^{|}]/g\n\t, expandRe = /\\{([#&+./;?]?)((?:[-\\w%.]+(\\*|:\\d+)?(?:,|(?=})))+)\\}/g\n\t, parseRe  = RegExp(expandRe.source + \"|.[^{]*?\", \"g\")\n\n\tfunction encodeNormal(val: string) {\n\t\treturn encodeURIComponent(val).replace(RESERVED, escape)\n\t}\n\n\tfunction escapeFn(str) {\n\t\treturn str.replace(escapeRe, \"\\\\$&\")\n\t}\n\n\tfunction catchDecode(str) {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str)\n\t\t} catch(e) {\n\t\t\treturn str\n\t\t}\n\t}\n\n\tfunction notNull(s) {\n\t\treturn s != null\n\t}\n\n\tfunction mapCleanJoin(arr, mapFn, joinStr) {\n\t\tarr = arr.map(mapFn).filter(notNull)\n\t\treturn arr.length && arr.join(joinStr)\n\t}\n\n\tfunction expand(template: string, data: Record<string, unknown>, opts?: IOptionsExpand) {\n\t\treturn template.replace(expandRe, function(_, op, vals) {\n\t\t\tvar sep = SEPARATORS[op] || op\n\t\t\t, named = sep == \";\" || sep == \"&\"\n\t\t\t, enc = op && sep == \",\" ? encodeURI : opts && opts.encoder || encodeNormal\n\t\t\t, out = mapCleanJoin(vals.split(\",\"), function(_name) {\n\t\t\t\tvar mod = _name.split(/[*:]/)\n\t\t\t\t, name = mod[0]\n\t\t\t\t, val: string = data[name] as any\n\n\t\t\t\tif (val == null) return\n\n\t\t\t\tif (typeof val == \"object\") {\n\t\t\t\t\tmod = name != _name\n\t\t\t\t\tif (Array.isArray(val)) {\n\t\t\t\t\t\tval = mapCleanJoin(val, enc, mod ? named ? sep + name + \"=\" : sep : \",\" )\n\t\t\t\t\t} else {\n\t\t\t\t\t\tval = mapCleanJoin(Object.keys(val), function(key) {\n\t\t\t\t\t\t\treturn enc(key) + (mod ? \"=\" : \",\") + enc(val[key])\n\t\t\t\t\t\t}, mod && (named || sep == \"/\") ? sep : \",\")\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tif (mod) named = 0\n\t\t\t\t\t}\n\t\t\t\t\tif (!val) return\n\t\t\t\t} else {\n\t\t\t\t\tval = enc(mod[1] ? val.slice(0, mod[1]) : val)\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\tnamed ?\n\t\t\t\t\tname + (val || sep == \"&\" ? \"=\" + val : val) :\n\t\t\t\t\tval\n\t\t\t\t)\n\t\t\t}, sep)\n\n\t\t\treturn out || out === \"\" ? (op != \"+\" ? op + out : out) : \"\"\n\t\t}\n\t)}\n\ninterface Template\n{\n\t(template: string, opts_?: IOptions): {\n\t\ttemplate: string\n\t\tmatch(uri: string): Record<string, unknown>\n\t\texpand(data: Record<string, unknown>): string\n\t}\n\n\tnew (template: string, opts_?: IOptions): {\n\t\ttemplate: string\n\t\tmatch(uri: string): Record<string, unknown>\n\t\texpand(data: Record<string, unknown>): string\n\t}\n}\n\n\tfunction Template(template: string, opts_?: IOptions) {\n\t\t// @ts-ignore\n\t\tvar self = this\n\t\t//if (!(self instanceof Template)) return new Template(template)\n\t\t\t// @ts-ignore\n\t\t, opts = Object.assign({\n\t\t\tdecoder: catchDecode\n\t\t}, opts_)\n\t\t, pos = 0\n\t\t, lengths = {}\n\t\t, fnStr = \"\"\n\t\t, reStr = \"^\" + template.replace(parseRe, function(_, op, vals) {\n\t\t\tif (!vals) return escapeFn(_)\n\n\t\t\tvar sep = SEPARATORS[op] || op\n\t\t\t, named = sep == \";\" || sep == \"&\"\n\t\t\treturn vals.split(\",\").map(function(_name, i) {\n\t\t\t\tvar mod = _name.split(/[*:]/)\n\t\t\t\t, name = mod[0]\n\t\t\t\t, re = (lengths[name] || \"(\") + \".*?)\"\n\n\t\t\t\tpos++\n\t\t\t\tif (mod[1]) {\n\t\t\t\t\tre = \"((?:%..|.){1,\" + mod[1] + \"})\"\n\t\t\t\t\tlengths[name] = \"(\\\\\" + pos\n\t\t\t\t}\n\t\t\t\tfnStr += \"t=($[\" + pos + \"]||'').split('\" + (mod[1] ? named ? sep + name + \"=\" : sep : \",\") + \"').map(d);\"\n\t\t\t\tfnStr += \"o[\\\"\" + name + \"\\\"]=\" + (mod[1] === \"\" ? \"t;\" : \"t.length>1?t:t[0];\")\n\t\t\t\tre = escapeFn(i === 0 ? op === \"+\" ? \"\" : op : sep) + (\n\t\t\t\t\tnamed ?\n\t\t\t\t\tescapeFn(name) + \"(?:=\" + re + \")?\" :\n\t\t\t\t\t//sep == \"&\" ?\n\t\t\t\t\t//escapeFn(name + \"=\") + re :\n\t\t\t\t\tre\n\t\t\t\t)\n\t\t\t\treturn mod[1] === \"\" ? \"(?:\" + re + \")?\" : re\n\t\t\t}).join(\"\")\n\t\t}) + \"$\"\n\t\t, re = RegExp(reStr)\n\t\t, fn = Function(\"$,d\", \"var t,o={};\" + fnStr + \"return o\")\n\n\t\tself.template = template\n\t\tself.match = function(uri) {\n\t\t\tvar match = re.exec(uri)\n\t\t\treturn match && fn(match, opts.decoder)\n\t\t}\n\n\t\tself.expand = function(data) {\n\t\t\treturn expand(template, data, opts)\n\t\t}\n\t}\n\nexport { Template }\nexport { expand }\nexport default Template\n\nexport interface IOptionsExpand\n{\n\tencoder?(val: string): string\n}\n\nexport interface IOptions extends IOptionsExpand\n{\n\tdecoder?(str: string): string\n}\n\n// @ts-ignore\nif (process.env.TSDX_FORMAT !== 'esm')\n{\n\tObject.defineProperty(Template, \"__esModule\", { value: true });\n\n\tObject.defineProperty(Template, 'Template', { value: Template });\n\tObject.defineProperty(Template, 'default', { value: Template });\n\n\tObject.defineProperty(Template, 'expand', { value: expand });\n\n}\n\n// `this` is `exports` in NodeJS and `window` in browser.\n // jshint ignore:line\n\n"],"names":["RESERVED","SEPARATORS","escapeRe","expandRe","parseRe","RegExp","source","encodeNormal","val","encodeURIComponent","replace","escape","escapeFn","str","catchDecode","decodeURIComponent","e","notNull","s","mapCleanJoin","arr","mapFn","joinStr","map","filter","length","join","expand","template","data","opts","_","op","vals","sep","named","enc","encodeURI","encoder","out","split","_name","mod","name","Array","isArray","Object","keys","key","slice","Template","opts_","self","this","assign","decoder","pos","lengths","fnStr","reStr","i","re","fn","Function","match","uri","exec","defineProperty","value"],"mappings":"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"}