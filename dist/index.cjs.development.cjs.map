{"version":3,"file":"index.cjs.development.cjs","sources":["../src/index.ts","../src/index.cts"],"sourcesContent":["/* global escape */\n\n\n/*! litejs.com/MIT-LICENSE.txt */\n\n\t/**\n\t * URI Template\n\t * @see http://tools.ietf.org/html/rfc6570\n\t */\n\n\tvar RESERVED = /[!'()]/g\n\t// /[[\\]:\\/!#$&()*+,;='?@]/g\n\t, SEPARATORS = {\"\": \",\", \"+\": \",\", \"#\": \",\", \"?\": \"&\"}\n\t, escapeRe = /[$-/?[-^{|}]/g\n\t, expandRe = /\\{([#&+./;?]?)((?:[-\\w%.]+(\\*|:\\d+)?(?:,|(?=})))+)\\}/g\n\t, parseRe  = RegExp(expandRe.source + \"|.[^{]*?\", \"g\")\n\n\tfunction encodeNormal(val: string) {\n\t\treturn encodeURIComponent(val).replace(RESERVED, escape)\n\t}\n\n\tfunction escapeFn(str) {\n\t\treturn str.replace(escapeRe, \"\\\\$&\")\n\t}\n\n\tfunction catchDecode(str) {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str)\n\t\t} catch(e) {\n\t\t\treturn str\n\t\t}\n\t}\n\n\tfunction notNull(s) {\n\t\treturn s != null\n\t}\n\n\tfunction mapCleanJoin(arr, mapFn, joinStr) {\n\t\tarr = arr.map(mapFn).filter(notNull)\n\t\treturn arr.length && arr.join(joinStr)\n\t}\n\n\tfunction expand(template: string, data: Record<string, unknown>, opts?: IOptionsExpand) {\n\t\treturn template.replace(expandRe, function(_, op, vals) {\n\t\t\tvar sep = SEPARATORS[op] || op\n\t\t\t, named = sep == \";\" || sep == \"&\"\n\t\t\t, enc = op && sep == \",\" ? encodeURI : opts && opts.encoder || encodeNormal\n\t\t\t, out = mapCleanJoin(vals.split(\",\"), function(_name) {\n\t\t\t\tvar mod = _name.split(/[*:]/)\n\t\t\t\t, name = mod[0]\n\t\t\t\t, val: string = data[name] as any\n\n\t\t\t\tif (val == null) return\n\n\t\t\t\tif (typeof val == \"object\") {\n\t\t\t\t\tmod = name != _name\n\t\t\t\t\tif (Array.isArray(val)) {\n\t\t\t\t\t\tval = mapCleanJoin(val, enc, mod ? named ? sep + name + \"=\" : sep : \",\" )\n\t\t\t\t\t} else {\n\t\t\t\t\t\tval = mapCleanJoin(Object.keys(val), function(key) {\n\t\t\t\t\t\t\treturn enc(key) + (mod ? \"=\" : \",\") + enc(val[key])\n\t\t\t\t\t\t}, mod && (named || sep == \"/\") ? sep : \",\")\n\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\tif (mod) named = 0\n\t\t\t\t\t}\n\t\t\t\t\tif (!val) return\n\t\t\t\t} else {\n\t\t\t\t\tval = enc(mod[1] ? val.slice(0, mod[1]) : val)\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\tnamed ?\n\t\t\t\t\tname + (val || sep == \"&\" ? \"=\" + val : val) :\n\t\t\t\t\tval\n\t\t\t\t)\n\t\t\t}, sep)\n\n\t\t\treturn out || out === \"\" ? (op != \"+\" ? op + out : out) : \"\"\n\t\t}\n\t)}\n\ninterface Template\n{\n\t(template: string, opts_?: IOptions): {\n\t\ttemplate: string\n\t\tmatch(uri: string): Record<string, unknown>\n\t\texpand(data: Record<string, unknown>): string\n\t}\n\n\tnew (template: string, opts_?: IOptions): {\n\t\ttemplate: string\n\t\tmatch(uri: string): Record<string, unknown>\n\t\texpand(data: Record<string, unknown>): string\n\t}\n}\n\n\tfunction Template(template: string, opts_?: IOptions) {\n\t\t// @ts-ignore\n\t\tvar self = this\n\t\t//if (!(self instanceof Template)) return new Template(template)\n\t\t\t// @ts-ignore\n\t\t, opts = Object.assign({\n\t\t\tdecoder: catchDecode\n\t\t}, opts_)\n\t\t, pos = 0\n\t\t, lengths = {}\n\t\t, fnStr = \"\"\n\t\t, reStr = \"^\" + template.replace(parseRe, function(_, op, vals) {\n\t\t\tif (!vals) return escapeFn(_)\n\n\t\t\tvar sep = SEPARATORS[op] || op\n\t\t\t, named = sep == \";\" || sep == \"&\"\n\t\t\treturn vals.split(\",\").map(function(_name, i) {\n\t\t\t\tvar mod = _name.split(/[*:]/)\n\t\t\t\t, name = mod[0]\n\t\t\t\t, re = (lengths[name] || \"(\") + \".*?)\"\n\n\t\t\t\tpos++\n\t\t\t\tif (mod[1]) {\n\t\t\t\t\tre = \"((?:%..|.){1,\" + mod[1] + \"})\"\n\t\t\t\t\tlengths[name] = \"(\\\\\" + pos\n\t\t\t\t}\n\t\t\t\tfnStr += \"t=($[\" + pos + \"]||'').split('\" + (mod[1] ? named ? sep + name + \"=\" : sep : \",\") + \"').map(d);\"\n\t\t\t\tfnStr += \"o[\\\"\" + name + \"\\\"]=\" + (mod[1] === \"\" ? \"t;\" : \"t.length>1?t:t[0];\")\n\t\t\t\tre = escapeFn(i === 0 ? op === \"+\" ? \"\" : op : sep) + (\n\t\t\t\t\tnamed ?\n\t\t\t\t\tescapeFn(name) + \"(?:=\" + re + \")?\" :\n\t\t\t\t\t//sep == \"&\" ?\n\t\t\t\t\t//escapeFn(name + \"=\") + re :\n\t\t\t\t\tre\n\t\t\t\t)\n\t\t\t\treturn mod[1] === \"\" ? \"(?:\" + re + \")?\" : re\n\t\t\t}).join(\"\")\n\t\t}) + \"$\"\n\t\t, re = RegExp(reStr)\n\t\t, fn = Function(\"$,d\", \"var t,o={};\" + fnStr + \"return o\")\n\n\t\tself.template = template\n\t\tself.match = function(uri) {\n\t\t\tvar match = re.exec(uri)\n\t\t\treturn match && fn(match, opts.decoder)\n\t\t}\n\n\t\tself.expand = function(data) {\n\t\t\treturn expand(template, data, opts)\n\t\t}\n\t}\n\nexport { Template }\nexport { expand }\nexport default Template\n\nexport interface IOptionsExpand\n{\n\tencoder?(val: string): string\n}\n\nexport interface IOptions extends IOptionsExpand\n{\n\tdecoder?(str: string): string\n}\n\n// @ts-ignore\nif (process.env.TSDX_FORMAT !== 'esm')\n{\n\tObject.defineProperty(Template, \"__esModule\", { value: true });\n\n\tObject.defineProperty(Template, 'Template', { value: Template });\n\tObject.defineProperty(Template, 'default', { value: Template });\n\n\tObject.defineProperty(Template, 'expand', { value: expand });\n\n}\n\n// `this` is `exports` in NodeJS and `window` in browser.\n // jshint ignore:line\n\n","import _ from './index';\n\n// @ts-ignore\nexport = _\n"],"names":["RESERVED","SEPARATORS","escapeRe","expandRe","parseRe","RegExp","source","encodeNormal","val","encodeURIComponent","replace","escape","escapeFn","str","catchDecode","decodeURIComponent","e","notNull","s","mapCleanJoin","arr","mapFn","joinStr","map","filter","length","join","expand","template","data","opts","_","op","vals","sep","named","enc","encodeURI","encoder","out","split","_name","mod","name","Array","isArray","Object","keys","key","slice","Template","opts_","self","assign","decoder","pos","lengths","fnStr","reStr","i","re","fn","Function","match","uri","exec","defineProperty","value","module","exports"],"mappings":"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"}